= EKS

== Quick Start

[source,bash]
----
terraform init -backend-config="profile=tu-dev-ueisele"
----

[source,bash]
----
terraform plan --var "profile=tu-dev-ueisele"
----

[source,bash]
----
aws eks --region eu-central-1 --profile tu-dev-ueisele update-kubeconfig --name asyncapi-eks
----

== IAM

https://docs.aws.amazon.com/eks/latest/userguide/add-user-role.html

Add the k8sadmin role to the aws-auth config map (ourput aws-auth-k8sadmin), and add users to asyncapi-eks-k8sadmin group.

To use it with aws cli and kubectl see: https://www.eksworkshop.com/beginner/091_iam-groups/test-cluster-access/

You can also add additional users directly to aws-auth:

[source,yaml]
----
  mapUsers: |
    - groups:
      - system:masters
      userarn: arn:aws:iam::<ACCOUNT>:user/<USER>
      username: admin
----

== Guides

* https://www.padok.fr/en/blog/aws-eks-cluster-terraform
* https://learn.hashicorp.com/tutorials/terraform/eks
* https://learnk8s.io/terraform-eks

== Connect to Instances

This VPC requires AWS Systems Manager Session Manager to connect to the Amazon EC2 instances.

[source,bash]
----
aws ssm start-session --profile tu-dev-ueisele --target i-07285b57d9a6ebaa2
----

* https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started.html
* https://aws.amazon.com/de/blogs/infrastructure-and-automation/toward-a-bastion-less-world/
* https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html
* http://docs.aws.amazon.com/console/systems-manager/session-manager-plugin-not-found
* https://jon.sprig.gs/blog/post/1928
